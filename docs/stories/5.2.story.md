# Story 5.2: MCP Server Integration Testing

## Status
Draft

## Story
**As a** quality engineer,
**I want** to test all MCP servers end-to-end,
**so that** API tools and knowledge retrieval work reliably.

## Acceptance Criteria
1. OAuth flow tested: authorization code exchange, token refresh, expiry handling
2. Rate limiting tested: verify throttling at 100 req/10s and 200k/day limits
3. All GHL API tools tested with real test account (workflows, contacts, funnels, forms, calendars)
4. Error handling tested: invalid inputs, network failures, expired tokens
5. Chroma vector DB tested: query performance, metadata filtering, collection isolation
6. Memory Service tested: context persistence across sessions
7. Integration test suite created with Jest (80%+ coverage)

## Tasks / Subtasks
- [ ] Test OAuth flow (AC: 1)
  - [ ] Test authorization code exchange
  - [ ] Test token refresh before expiry
  - [ ] Test expired token handling
  - [ ] Test invalid credentials
- [ ] Test rate limiting (AC: 2)
  - [ ] Test burst limit enforcement (100 req/10s)
  - [ ] Test daily limit enforcement (200k/day)
  - [ ] Test queue processing
  - [ ] Test exponential backoff
- [ ] Test GHL API tools (AC: 3)
  - [ ] Test workflow tools (create, list, get, update, delete)
  - [ ] Test contact tools
  - [ ] Test funnel tools
  - [ ] Test form tools
  - [ ] Test calendar tools
- [ ] Test error handling (AC: 4)
  - [ ] Test invalid inputs
  - [ ] Test network timeouts
  - [ ] Test expired tokens
  - [ ] Test API errors (4xx, 5xx)
- [ ] Test Chroma (AC: 5)
  - [ ] Benchmark query performance
  - [ ] Test metadata filtering
  - [ ] Verify collection isolation
- [ ] Test Memory Service (AC: 6)
  - [ ] Test context storage
  - [ ] Test context retrieval
  - [ ] Test persistence across restarts
- [ ] Create integration test suite (AC: 7)
  - [ ] Set up Jest for integration tests
  - [ ] Achieve 80%+ coverage
  - [ ] Document test results

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-25 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record
_(To be filled by Dev Agent)_

## QA Results
_(To be filled by QA Agent)_
