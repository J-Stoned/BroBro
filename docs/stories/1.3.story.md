# Story 1.3: Memory Service MCP Server Configuration

## Status
Draft

## Story
**As a** user,
**I want** conversation context to persist across interactions,
**so that** the assistant remembers previous questions and provides coherent multi-turn conversations.

## Acceptance Criteria
1. Memory Service MCP server installed (HTTP transport)
2. Configured in `.claude/settings.local.json` with correct URL
3. Test memory storage and retrieval via simple commands
4. Memory persists across Claude Code restarts
5. Memory can be cleared manually when needed

## Tasks / Subtasks
- [ ] Install Memory Service MCP server (AC: 1)
  - [ ] Research available memory service MCP implementations
  - [ ] Install chosen memory service via npm or Docker
  - [ ] Configure HTTP transport endpoint
  - [ ] Start memory service and verify it's running
  - [ ] Test basic health check endpoint
- [ ] Configure MCP server in Claude Code (AC: 2)
  - [ ] Add memory service entry to `.claude/settings.local.json`
  - [ ] Configure transport type as HTTP
  - [ ] Set correct URL for memory service
  - [ ] Add any required authentication or API keys
  - [ ] Restart Claude Code to load configuration
- [ ] Test memory operations (AC: 3, 4)
  - [ ] Create test script for memory storage
  - [ ] Test storing conversation context
  - [ ] Test retrieving stored context
  - [ ] Test updating existing context
  - [ ] Restart Claude Code and verify persistence
  - [ ] Confirm memory retrieval after restart
- [ ] Implement memory clearing mechanism (AC: 5)
  - [ ] Document API endpoint for clearing memory
  - [ ] Create convenience script for memory reset
  - [ ] Test memory clearing functionality
  - [ ] Add clear memory command to documentation
- [ ] Document memory service usage
  - [ ] Add memory service section to README.md
  - [ ] Document how to start/stop memory service
  - [ ] Document memory clearing procedures
  - [ ] Add troubleshooting for memory persistence issues

## Dev Notes

### Memory Service Purpose
[Source: architecture/4-system-architecture.md]

The Memory Service MCP server provides conversation context persistence, allowing the assistant to remember previous questions, decisions, and context across multiple interactions. This enhances the coherence of multi-turn conversations.

**Server Configuration:**
- **Server ID:** `memory-service`
- **Transport:** HTTP
- **Purpose:** Session management and context persistence

### MCP Configuration
[Source: architecture/source-tree.md]

**Add to `.claude/settings.local.json`:**
```json
{
  "mcp": {
    "servers": {
      "memory-service": {
        "transport": "http",
        "url": "http://localhost:3000"
      }
    }
  }
}
```

### Memory Operations

**Expected functionality:**
- Store conversation context with key-value pairs
- Retrieve context based on conversation ID or session
- Update existing context as conversation progresses
- Clear memory when starting fresh topics
- Persist memory across application restarts

### Integration with GHL Wiz

The memory service will help the assistant:
- Remember which GHL features the user is working on
- Maintain context about workflow designs across multiple commands
- Recall user preferences for response style or detail level
- Track multi-step processes (e.g., building a funnel across multiple interactions)

### Testing

**Test Standards:**
[Source: architecture/11-testing-strategy.md]

- Create integration tests for memory operations
- Test storage and retrieval
- Test persistence across restarts
- Test memory clearing
- Verify no memory leaks
- Test concurrent access scenarios

**Test Coverage:**
- Memory storage with various data types
- Memory retrieval with valid and invalid keys
- Memory updates
- Memory deletion
- Persistence verification
- Error handling

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-25 | 1.0 | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used
_(To be filled by Dev Agent)_

### Debug Log References
_(To be filled by Dev Agent)_

### Completion Notes List
_(To be filled by Dev Agent)_

### File List
_(To be filled by Dev Agent)_

## QA Results

### Review Date: 2025-10-25

### Reviewed By: Quinn (Test Architect)

### Summary
Story 1.3 has **critical technical gaps** that block development. No specific Memory Service MCP implementation is identified, architecture details are missing, and a "research" task in the story indicates incomplete planning. This story should return to PM/Architect for specification completion before development.

### Critical Issues - Story Not Ready

**Why FAIL:**
1. Story includes "research available memory service MCP implementations" task
2. This is pre-work that should be done BEFORE story creation
3. Developer cannot start without knowing WHAT to install
4. Missing all technical specifications needed for implementation

### Comparison to Story 1.2 (Chroma)
Story 1.2 had complete specs:
- ✅ Specific Docker image: `chromadb/chroma:latest`
- ✅ Complete collection schemas with metadata
- ✅ HNSW index configuration parameters
- ✅ Performance expectations

Story 1.3 lacks equivalent detail:
- ❌ No specific MCP server identified
- ❌ No data schema
- ❌ No storage mechanism specified
- ❌ No API contract defined

### Findings
**High Severity Issues (2) - BLOCKERS:**

1. **ARCH-002:** No specific Memory Service MCP implementation identified
   - **Impact:** Developer cannot start work without knowing what to install
   - **Required:** Identify exact package (e.g., `@modelcontextprotocol/server-memory`, custom implementation)

2. **REQ-002:** Architecture provides no technical specifications
   - **Impact:** Cannot design tests, cannot implement, cannot verify ACs
   - **Required:** Storage backend, data schema, API endpoints, persistence mechanism

**Medium Severity Issues (3):**

3. **ARCH-003:** Port 3000 conflicts potential (common dev port)
   - **Suggested Action:** Document port configuration, consider non-standard port (3100)

4. **TEST-003:** Test tasks too vague (no framework, file paths, or structure)
   - **Suggested Action:** Specify: `tests/mcp-servers/memory-service.test.js` using Jest

5. **REL-001:** No data backup/recovery strategy
   - **Suggested Action:** Define storage location and backup procedures

**Low Severity Issues (2):**

6. **DOC-003:** Missing npm scripts for memory service lifecycle
7. **SEC-002:** No authentication mechanism mentioned

### Testability Score: 4/10
ACs are theoretically testable, but **cannot write actual tests** without:
- Data schema specification
- API contract/endpoints
- Persistence mechanism details
- Storage location

### NFR Validation
- **Reliability:** ❌ FAIL - No backup/recovery, no error handling
- **Performance:** ❓ UNKNOWN - Cannot assess without storage backend
- **Security:** ⚠️ CONCERNS - No authentication specified
- **Maintainability:** ⚠️ CONCERNS - Vague specs make maintenance difficult
- **Scalability:** ❓ UNKNOWN - Storage mechanism unclear

### Architecture Gaps - Must Add

**Missing Specifications:**
- Memory Service MCP package name/source
- Installation method (npm, Docker, from source)
- Storage backend (SQLite, JSON file, in-memory)
- Data schema for conversation context
- API endpoints and contracts
- Persistence file location
- Memory size limits and cleanup policies
- Concurrent access handling
- Error recovery procedures

### Recommendations

**CRITICAL - Before Development:**
1. **Return to PM/Architect** for specification completion
2. **Research and select** specific Memory Service MCP implementation
3. **Add complete technical spec** to architecture document
4. **Remove "research" task** - all decisions should be pre-made

**Consider Story Splitting:**
- Story 1.3a: Research and select Memory Service implementation
- Story 1.3b: Install and configure selected Memory Service

**Minimum Additions Needed:**
- Specify exact MCP server package
- Add data schema example
- Define storage location and mechanism
- Document API contract or MCP tools
- Add test file paths and framework
- Document port configuration
- Add backup/recovery procedures

### Gate Status
Gate: **FAIL** → [docs/qa/gates/1.3-memory-service-mcp-server-configuration.yml](../qa/gates/1.3-memory-service-mcp-server-configuration.yml)

**Decision:** Story must return to PM/Architect for completion. Cannot proceed to development with current level of specification. Recommend completing architecture work or splitting into research + implementation stories.
